<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JUST.DB - è¦‹ç©ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* ==========================================
       CSS Custom Properties (Design Tokens)
       ========================================== */
    :root {
      --navy: #1a3a5c;
      --navy-light: #2a5a8c;
      --navy-dark: #0f2440;
      --orange: #f07900;
      --orange-light: #fff3e6;
      --orange-hover: #d96b00;
      --bg: #f5f6fa;
      --card-bg: #ffffff;
      --text-primary: #2c3e50;
      --text-secondary: #6c7a89;
      --text-muted: #95a5a6;
      --success: #27ae60;
      --border: #e1e8ef;
      --shadow: 0 2px 12px rgba(26, 58, 92, 0.08);
      --shadow-lg: 0 8px 32px rgba(26, 58, 92, 0.12);
      --radius: 12px;
      --radius-sm: 8px;
      --font: 'Noto Sans JP', sans-serif;
      --transition: all 0.2s ease;
    }

    /* ==========================================
       Reset & Base
       ========================================== */
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    html { font-size: 16px; scroll-behavior: smooth; }
    body { font-family: var(--font); background: var(--bg); color: var(--text-primary); line-height: 1.6; min-height: 100vh; }

    /* ==========================================
       Header
       ========================================== */
    .app-header {
      background: linear-gradient(135deg, var(--navy) 0%, var(--navy-light) 100%);
      color: #fff; padding: 20px 32px; display: flex; align-items: center;
      justify-content: space-between; box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      position: sticky; top: 0; z-index: 100;
    }
    .header-brand { display: flex; align-items: center; gap: 16px; }
    .header-logo { font-size: 1.5rem; font-weight: 700; letter-spacing: 0.02em; }
    .header-logo span { color: var(--orange); }
    .header-subtitle { font-size: 0.875rem; opacity: 0.85; font-weight: 400; }
    .header-date { font-size: 0.8rem; opacity: 0.7; }

    /* ==========================================
       Layout
       ========================================== */
    .app-layout {
      display: grid; grid-template-columns: 1fr 460px; gap: 28px;
      max-width: 1440px; margin: 0 auto; padding: 28px 32px 120px;
    }
    .configurator { display: flex; flex-direction: column; gap: 20px; }
    .results-panel {
      position: sticky; top: 88px; height: fit-content;
      max-height: calc(100vh - 108px); overflow-y: auto;
    }

    /* ==========================================
       Config Sections
       ========================================== */
    .config-section {
      background: var(--card-bg); border-radius: var(--radius); padding: 24px;
      box-shadow: var(--shadow); border: 1px solid var(--border); transition: var(--transition);
    }
    .section-header { display: flex; align-items: center; gap: 10px; margin-bottom: 16px; }
    .section-icon {
      width: 36px; height: 36px; border-radius: var(--radius-sm);
      background: var(--orange-light); display: flex; align-items: center;
      justify-content: center; font-size: 1.1rem; flex-shrink: 0;
    }
    .section-title { font-size: 1rem; font-weight: 700; color: var(--navy); }
    .section-subtitle { font-size: 0.8rem; color: var(--text-muted); margin-top: 2px; }
    .section-hint {
      font-size: 0.8rem; color: var(--text-secondary); background: var(--bg);
      padding: 8px 12px; border-radius: var(--radius-sm); margin-bottom: 12px; line-height: 1.5;
    }

    /* ==========================================
       License Stepper
       ========================================== */
    .license-stepper { display: flex; align-items: center; justify-content: center; gap: 16px; margin-bottom: 16px; }
    .stepper-btn {
      width: 44px; height: 44px; border-radius: 50%; border: 2px solid var(--navy);
      background: #fff; color: var(--navy); font-size: 1.3rem; font-weight: 700;
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      transition: var(--transition); user-select: none;
    }
    .stepper-btn:hover:not(:disabled) { background: var(--navy); color: #fff; }
    .stepper-btn:disabled { opacity: 0.3; cursor: not-allowed; }
    .stepper-value {
      font-size: 2.5rem; font-weight: 700; color: var(--navy); min-width: 100px;
      text-align: center; cursor: text; border: 2px solid transparent;
      border-radius: var(--radius-sm); padding: 4px 8px; transition: var(--transition);
    }
    .stepper-value:focus { outline: none; border-color: var(--orange); background: var(--orange-light); }
    .stepper-unit { font-size: 0.9rem; color: var(--text-secondary); font-weight: 500; }
    .license-slider-wrap { padding: 0 4px; margin-bottom: 12px; }
    .license-slider {
      width: 100%; height: 6px; -webkit-appearance: none; appearance: none;
      background: var(--border); border-radius: 3px; outline: none; cursor: pointer;
    }
    .license-slider::-webkit-slider-thumb {
      -webkit-appearance: none; width: 22px; height: 22px; border-radius: 50%;
      background: var(--orange); cursor: pointer; box-shadow: 0 2px 6px rgba(240,121,0,0.3);
      transition: transform 0.15s ease;
    }
    .license-slider::-webkit-slider-thumb:hover { transform: scale(1.15); }
    .license-slider::-moz-range-thumb {
      width: 22px; height: 22px; border-radius: 50%; background: var(--orange);
      cursor: pointer; border: none; box-shadow: 0 2px 6px rgba(240,121,0,0.3);
    }
    .license-cost { text-align: center; font-size: 0.9rem; color: var(--text-secondary); }
    .license-cost strong { color: var(--orange); font-size: 1.1rem; }

    /* ==========================================
       Package Cards
       ========================================== */
    .package-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
    .package-card {
      border: 2px solid var(--border); border-radius: var(--radius); padding: 18px;
      cursor: pointer; transition: var(--transition); position: relative;
    }
    .package-card:hover { border-color: var(--navy-light); box-shadow: var(--shadow); }
    .package-card.selected { border-color: var(--orange); background: var(--orange-light); box-shadow: 0 0 0 3px rgba(240,121,0,0.15); }
    .package-card-check {
      position: absolute; top: 10px; right: 10px; width: 22px; height: 22px;
      border-radius: 50%; border: 2px solid var(--border); display: flex;
      align-items: center; justify-content: center; font-size: 0.7rem; transition: var(--transition);
    }
    .package-card.selected .package-card-check { background: var(--orange); border-color: var(--orange); color: #fff; }
    .package-name { font-weight: 700; font-size: 0.85rem; color: var(--navy); margin-bottom: 6px; }
    .package-price { font-size: 1.15rem; font-weight: 700; color: var(--orange); margin-bottom: 10px; }
    .package-price .price-unit { font-size: 0.7rem; font-weight: 500; color: var(--text-secondary); }
    .package-features { list-style: none; font-size: 0.75rem; color: var(--text-secondary); }
    .package-features li { padding: 2px 0; padding-left: 16px; position: relative; }
    .package-features li::before { content: 'âœ“'; position: absolute; left: 0; color: var(--success); font-weight: 700; }
    .package-note {
      margin-top: 10px; padding: 6px 10px; background: #fef3cd; border-radius: var(--radius-sm);
      font-size: 0.7rem; color: #856404; display: none;
    }
    .package-card.selected .package-note { display: block; }

    /* ==========================================
       Comparison Table (collapsible)
       ========================================== */
    .comparison-toggle {
      margin-top: 16px; border: 1px solid var(--border); border-radius: var(--radius-sm); overflow: hidden;
    }
    .comparison-toggle summary {
      padding: 10px 14px; font-size: 0.85rem; font-weight: 700; color: var(--navy);
      cursor: pointer; background: var(--bg); list-style: none; display: flex;
      align-items: center; gap: 6px;
    }
    .comparison-toggle summary::before { content: 'â–¶'; font-size: 0.65rem; transition: transform 0.2s; }
    .comparison-toggle[open] summary::before { transform: rotate(90deg); }
    .comparison-table {
      width: 100%; border-collapse: collapse; font-size: 0.75rem;
    }
    .comparison-table th, .comparison-table td {
      padding: 8px 10px; border-bottom: 1px solid var(--border); text-align: center;
    }
    .comparison-table th { background: var(--navy); color: #fff; font-weight: 500; font-size: 0.7rem; }
    .comparison-table th:first-child { text-align: left; }
    .comparison-table td:first-child { text-align: left; font-weight: 500; color: var(--text-primary); }
    .comparison-table tr:last-child td { border-bottom: none; }
    .comparison-table tr:nth-child(even) { background: #f8f9fd; }

    /* ==========================================
       Phase Slider Rows (Construction Cost)
       ========================================== */
    .phase-list { display: flex; flex-direction: column; gap: 14px; }
    .phase-row {
      padding: 14px 16px; border: 1px solid var(--border); border-radius: var(--radius-sm);
      background: #fff; transition: var(--transition);
    }
    .phase-row-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 4px; }
    .phase-name { font-size: 0.85rem; font-weight: 700; color: var(--navy); }
    .phase-subtotal { font-size: 0.9rem; font-weight: 700; color: var(--orange); }
    .phase-meta { font-size: 0.7rem; color: var(--text-muted); margin-bottom: 8px; }
    .phase-slider-row { display: flex; align-items: center; gap: 10px; }
    .phase-slider {
      flex: 1; height: 5px; -webkit-appearance: none; appearance: none;
      background: var(--border); border-radius: 3px; outline: none; cursor: pointer;
    }
    .phase-slider::-webkit-slider-thumb {
      -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%;
      background: var(--navy); cursor: pointer; box-shadow: 0 1px 4px rgba(0,0,0,0.2);
    }
    .phase-slider::-moz-range-thumb {
      width: 18px; height: 18px; border-radius: 50%; background: var(--navy);
      cursor: pointer; border: none;
    }
    .phase-hours { font-size: 0.85rem; font-weight: 700; color: var(--navy); min-width: 50px; text-align: right; }
    .construction-total-bar {
      margin-top: 16px; padding: 14px 16px; background: var(--navy); color: #fff;
      border-radius: var(--radius-sm); display: flex; justify-content: space-between; align-items: center;
    }
    .construction-total-label { font-size: 0.85rem; font-weight: 500; }
    .construction-total-value { font-size: 1.2rem; font-weight: 700; }

    /* ==========================================
       Support Pack
       ========================================== */
    .support-toggle-wrap { margin-bottom: 14px; }
    .support-toggle-label {
      display: flex; align-items: center; gap: 10px; cursor: pointer;
      font-size: 0.875rem; font-weight: 500;
    }
    .support-toggle-label input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--orange); cursor: pointer; }
    .support-pack-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
    .support-pack-card {
      border: 2px solid var(--border); border-radius: var(--radius-sm); padding: 14px;
      cursor: pointer; transition: var(--transition); text-align: center;
    }
    .support-pack-card:hover { border-color: var(--navy-light); }
    .support-pack-card.selected { border-color: var(--orange); background: var(--orange-light); }
    .support-pack-name { font-size: 0.8rem; font-weight: 700; color: var(--navy); margin-bottom: 4px; }
    .support-pack-price { font-size: 1rem; font-weight: 700; color: var(--orange); }
    .support-pack-detail { font-size: 0.7rem; color: var(--text-muted); margin-top: 4px; }
    .support-pack-unit { font-size: 0.7rem; color: var(--text-secondary); margin-top: 2px; }
    .support-pack-area { display: none; }
    .support-pack-area.visible { display: block; }
    .support-note {
      margin-top: 10px; font-size: 0.7rem; color: var(--text-muted); line-height: 1.6;
      padding: 8px 10px; background: var(--bg); border-radius: var(--radius-sm);
    }
    .support-recommendation {
      margin-top: 10px; padding: 10px 12px; background: #e8f5e9; border-radius: var(--radius-sm);
      font-size: 0.75rem; color: #2e7d32; font-weight: 500;
    }

    /* ==========================================
       Contract Period
       ========================================== */
    .period-segments {
      display: flex; border-radius: var(--radius-sm); overflow: hidden; border: 2px solid var(--navy);
    }
    .period-btn {
      flex: 1; padding: 12px; border: none; background: #fff; color: var(--navy);
      font-family: var(--font); font-size: 0.9rem; font-weight: 700;
      cursor: pointer; transition: var(--transition); text-align: center;
    }
    .period-btn:not(:last-child) { border-right: 2px solid var(--navy); }
    .period-btn:hover:not(.active) { background: #eef2f7; }
    .period-btn.active { background: var(--navy); color: #fff; }
    .contract-calc { margin-top: 14px; text-align: center; font-size: 0.85rem; color: var(--text-secondary); }
    .contract-calc strong { font-size: 1.05rem; color: var(--navy); }

    /* ==========================================
       Results Panel
       ========================================== */
    .results-card {
      background: var(--card-bg); border-radius: var(--radius);
      box-shadow: var(--shadow-lg); border: 1px solid var(--border); overflow: hidden;
    }
    .results-header {
      background: linear-gradient(135deg, var(--navy) 0%, var(--navy-light) 100%);
      color: #fff; padding: 18px 24px;
    }
    .results-title { font-size: 1rem; font-weight: 700; margin-bottom: 4px; }
    .results-date { font-size: 0.75rem; opacity: 0.75; }

    .result-category {
      padding: 10px 24px; background: var(--bg); font-size: 0.75rem;
      font-weight: 700; color: var(--navy); letter-spacing: 0.05em;
      border-bottom: 1px solid var(--border);
    }

    .total-section { padding: 20px 24px; text-align: center; border-bottom: 1px solid var(--border); }
    .total-label { font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 4px; }
    .total-amount { font-size: 2.2rem; font-weight: 700; color: var(--navy); line-height: 1.2; }
    .total-tax { font-size: 0.85rem; color: var(--text-muted); margin-top: 4px; }
    .total-tax strong { color: var(--text-primary); font-size: 1rem; }

    .grand-total-section {
      padding: 20px 24px; text-align: center; border-bottom: 1px solid var(--border);
      background: linear-gradient(135deg, #f8f9fd 0%, #fff3e6 100%);
    }
    .grand-total-label { font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 4px; }
    .grand-total-amount { font-size: 2rem; font-weight: 700; color: var(--orange); line-height: 1.2; }
    .grand-total-breakdown { font-size: 0.75rem; color: var(--text-muted); margin-top: 6px; }

    .chart-section { padding: 20px 24px; border-bottom: 1px solid var(--border); }
    .chart-container { max-width: 240px; margin: 0 auto; }

    /* ==========================================
       Detail Table
       ========================================== */
    .detail-section { padding: 16px 24px; border-bottom: 1px solid var(--border); }
    .detail-section-title {
      font-size: 0.75rem; font-weight: 700; color: var(--navy);
      margin-bottom: 10px; letter-spacing: 0.05em;
    }
    .detail-table { width: 100%; border-collapse: collapse; font-size: 0.78rem; }
    .detail-table th {
      text-align: left; font-weight: 500; color: var(--text-muted);
      padding: 5px 0; border-bottom: 1px solid var(--border); font-size: 0.7rem;
    }
    .detail-table th:last-child { text-align: right; }
    .detail-table td { padding: 6px 0; border-bottom: 1px solid #f0f2f5; }
    .detail-table td:last-child { text-align: right; font-weight: 500; }
    .detail-table tr:last-child td { border-bottom: none; }
    .detail-table .subtotal-row { font-weight: 700; }
    .detail-table .subtotal-row td { border-top: 2px solid var(--navy); padding-top: 8px; }
    .detail-table .tbd { color: var(--text-muted); font-style: italic; }
    .detail-table .section-label td {
      font-weight: 700; color: var(--navy); font-size: 0.72rem;
      padding-top: 12px; border-bottom: 1px solid var(--border);
    }

    /* ==========================================
       Notes
       ========================================== */
    .notes-section { padding: 14px 24px; border-bottom: 1px solid var(--border); }
    .notes-section .detail-section-title { margin-bottom: 6px; }
    .notes-category { font-size: 0.7rem; font-weight: 700; color: var(--navy); margin-top: 8px; margin-bottom: 4px; }
    .notes-list { font-size: 0.68rem; color: var(--text-muted); line-height: 1.7; list-style: none; }
    .notes-list li { padding-left: 12px; position: relative; }
    .notes-list li::before { content: 'ãƒ»'; position: absolute; left: 0; }

    /* ==========================================
       Action Buttons
       ========================================== */
    .action-bar { padding: 14px 24px; display: flex; gap: 8px; }
    .btn {
      flex: 1; padding: 10px 16px; border-radius: var(--radius-sm); border: none;
      font-family: var(--font); font-size: 0.8rem; font-weight: 700; cursor: pointer;
      transition: var(--transition); display: flex; align-items: center;
      justify-content: center; gap: 6px;
    }
    .btn-primary { background: var(--orange); color: #fff; }
    .btn-primary:hover { background: var(--orange-hover); }
    .btn-secondary { background: var(--navy); color: #fff; }
    .btn-secondary:hover { background: var(--navy-light); }
    .btn-outline { background: #fff; color: var(--text-secondary); border: 1px solid var(--border); }
    .btn-outline:hover { background: var(--bg); color: var(--text-primary); }
    .btn-icon { font-size: 1rem; }

    .copy-feedback {
      position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%) translateY(20px);
      background: var(--navy); color: #fff; padding: 10px 24px; border-radius: var(--radius-sm);
      font-size: 0.85rem; font-weight: 500; box-shadow: var(--shadow-lg);
      opacity: 0; pointer-events: none; transition: all 0.3s ease; z-index: 200;
    }
    .copy-feedback.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    /* ==========================================
       Mobile Total Bar
       ========================================== */
    .mobile-total-bar {
      display: none; position: fixed; bottom: 0; left: 0; right: 0;
      background: var(--navy); color: #fff; padding: 14px 24px;
      z-index: 100; box-shadow: 0 -4px 12px rgba(0,0,0,0.15);
    }
    .mobile-total-inner { display: flex; align-items: center; justify-content: space-between; max-width: 600px; margin: 0 auto; }
    .mobile-total-label { font-size: 0.75rem; opacity: 0.8; }
    .mobile-total-amount { font-size: 1.3rem; font-weight: 700; }

    /* ==========================================
       Responsive
       ========================================== */
    @media (max-width: 1023px) {
      .app-layout { grid-template-columns: 1fr; padding: 20px 16px 140px; gap: 20px; }
      .results-panel { position: static; max-height: none; }
      .mobile-total-bar { display: block; }
    }
    @media (max-width: 767px) {
      .app-header { padding: 14px 16px; flex-direction: column; align-items: flex-start; gap: 4px; }
      .header-date { display: none; }
      .config-section { padding: 18px 16px; }
      .package-grid { grid-template-columns: 1fr; }
      .support-pack-grid { grid-template-columns: 1fr; }
      .stepper-value { font-size: 2rem; }
      .total-amount { font-size: 1.8rem; }
      .grand-total-amount { font-size: 1.6rem; }
      .action-bar { flex-direction: column; }
    }

    /* ==========================================
       Print Styles
       ========================================== */
    @media print {
      body { background: #fff; font-size: 11px; }
      .app-header { position: static; background: var(--navy); -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      .app-layout { display: block; padding: 0; max-width: 700px; margin: 0 auto; }
      .configurator { display: none; }
      .results-panel { position: static; max-height: none; }
      .results-card { box-shadow: none; border: 1px solid #ddd; }
      .results-header { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      .result-category { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      .grand-total-section { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      .action-bar { display: none; }
      .mobile-total-bar { display: none !important; }
      .copy-feedback { display: none !important; }
      .chart-section { page-break-inside: avoid; }
      .detail-section { page-break-inside: avoid; }
    }

    /* Scrollbar */
    .results-panel::-webkit-scrollbar { width: 4px; }
    .results-panel::-webkit-scrollbar-track { background: transparent; }
    .results-panel::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="app-header">
    <div class="header-brand">
      <div class="header-logo">JUST<span>.DB</span></div>
      <div class="header-subtitle">è¦‹ç©ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</div>
    </div>
    <div class="header-date" id="headerDate"></div>
  </header>

  <!-- Main Layout -->
  <main class="app-layout">

    <!-- Left: Configurator -->
    <section class="configurator">

      <!-- â‘  License Settings -->
      <div class="config-section">
        <div class="section-header">
          <div class="section-icon">ğŸ‘¥</div>
          <div>
            <div class="section-title">ãƒ©ã‚¤ã‚»ãƒ³ã‚¹è¨­å®š</div>
            <div class="section-subtitle">åŒæ™‚ãƒ­ã‚°ã‚¤ãƒ³ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</div>
          </div>
        </div>
        <div class="section-hint">
          å…¨å“¡ãŒå¸¸æ™‚ä½¿ã‚ãªã„å ´åˆã€ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã‚ˆã‚Šå°‘ãªãè¨­å®šã§ãã¾ã™ã€‚5ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å˜ä½ã§ã®è³¼å…¥ã¨ãªã‚Šã¾ã™ã€‚
        </div>
        <div class="license-stepper">
          <button class="stepper-btn" id="licenseMinus" aria-label="5æ¸›ã‚‰ã™">âˆ’</button>
          <div>
            <div class="stepper-value" id="licenseValue" tabindex="0" role="spinbutton" aria-label="ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æ•°" aria-valuemin="5" aria-valuemax="100" contenteditable="true">10</div>
            <div class="stepper-unit">ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</div>
          </div>
          <button class="stepper-btn" id="licensePlus" aria-label="5å¢—ã‚„ã™">ï¼‹</button>
        </div>
        <div class="license-slider-wrap">
          <input type="range" class="license-slider" id="licenseSlider" min="5" max="100" step="5" value="10">
        </div>
        <div class="license-cost" id="licenseCostDisplay"></div>
      </div>

      <!-- â‘¡ Package Selection -->
      <div class="config-section">
        <div class="section-header">
          <div class="section-icon">ğŸ“¦</div>
          <div>
            <div class="section-title">ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é¸æŠ</div>
            <div class="section-subtitle">1ãƒ†ãƒŠãƒ³ãƒˆã‚ãŸã‚Š / æœˆé¡ï¼ˆç¨åˆ¥ï¼‰</div>
          </div>
        </div>

        <div class="package-grid">
          <div class="package-card selected" data-package="none">
            <div class="package-card-check">âœ“</div>
            <div class="package-name">ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãªã—</div>
            <div class="package-price">Â¥0 <span class="price-unit">/æœˆ</span></div>
            <ul class="package-features">
              <li>åŸºæœ¬æ©Ÿèƒ½ã®ã¿</li>
            </ul>
          </div>

          <div class="package-card" data-package="basic">
            <div class="package-card-check">âœ“</div>
            <div class="package-name">ãƒ™ãƒ¼ã‚·ãƒƒã‚¯</div>
            <div class="package-price">Â¥24,000 <span class="price-unit">/æœˆ</span></div>
            <ul class="package-features">
              <li>ç¤¾å†…DBé€£æº</li>
              <li>å…¨æ–‡æ¤œç´¢</li>
              <li>ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹</li>
              <li>AI-OCRï¼ˆåˆå›100å›è©¦ç”¨ï¼‰</li>
            </ul>
          </div>

          <div class="package-card" data-package="standard">
            <div class="package-card-check">âœ“</div>
            <div class="package-name">ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰</div>
            <div class="package-price">Â¥74,000 <span class="price-unit">/æœˆ</span></div>
            <ul class="package-features">
              <li>AI-OCRï¼ˆæ¯æœˆ1,000CRï¼‰</li>
              <li>å¤§è¦æ¨¡é›†è¨ˆï¼ˆ2,000ä¸‡ä»¶ï¼‰</li>
              <li>è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆ35æ—¥åˆ†ï¼‰</li>
              <li>ãƒ™ãƒ¼ã‚·ãƒƒã‚¯å…¨æ©Ÿèƒ½å«ã‚€</li>
            </ul>
            <div class="package-note">â€» 2026å¹´2æœˆ17æ—¥æä¾›é–‹å§‹ã€‚ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ã‹ã‚‰ã®å·®é¡ã¯Â¥50,000/æœˆã€‚</div>
          </div>
        </div>

        <!-- Comparison Table -->
        <details class="comparison-toggle">
          <summary>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ¯”è¼ƒè¡¨ã‚’è¦‹ã‚‹</summary>
          <table class="comparison-table">
            <thead>
              <tr><th>è¦³ç‚¹</th><th>ãªã—</th><th>ãƒ™ãƒ¼ã‚·ãƒƒã‚¯</th><th>ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰</th></tr>
            </thead>
            <tbody>
              <tr><td>æœˆé¡ï¼ˆç¨åˆ¥ï¼‰</td><td>Â¥0</td><td>Â¥24,000</td><td>Â¥74,000</td></tr>
              <tr><td>ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</td><td>æ‰‹å‹•</td><td>æ‰‹å‹•</td><td>35æ—¥åˆ†è‡ªå‹•</td></tr>
              <tr><td>é›†è¨ˆä¸Šé™</td><td>æ¨™æº–</td><td>5ä¸‡ä»¶</td><td>2,000ä¸‡ä»¶</td></tr>
              <tr><td>AI-OCR</td><td>ãªã—</td><td>è©¦ç”¨100å›</td><td>æ¯æœˆ1,000CR</td></tr>
              <tr><td>ãƒ†ãƒ¼ãƒ–ãƒ«å†…ä»¶æ•°</td><td>æ¨™æº–</td><td>500ä¸‡ä»¶</td><td>2,000ä¸‡ä»¶</td></tr>
            </tbody>
          </table>
        </details>
      </div>

      <!-- â‘¢ Construction Cost (Phase-based) -->
      <div class="config-section">
        <div class="section-header">
          <div class="section-icon">ğŸ”§</div>
          <div>
            <div class="section-title">ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰è²»ç”¨</div>
            <div class="section-subtitle">ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥å·¥æ•° Ã— äººä»¶è²»å˜ä¾¡ï¼ˆç¨åˆ¥ï¼‰</div>
          </div>
        </div>
        <div class="phase-list" id="phaseList">
          <!-- Generated by JS -->
        </div>
        <div class="construction-total-bar">
          <span class="construction-total-label">æ§‹ç¯‰è²»ç”¨åˆè¨ˆï¼ˆç¨åˆ¥ï¼‰</span>
          <span class="construction-total-value" id="constructionTotal">Â¥0</span>
        </div>
      </div>

      <!-- â‘£ Support Pack -->
      <div class="config-section">
        <div class="section-header">
          <div class="section-icon">ğŸ›Ÿ</div>
          <div>
            <div class="section-title">ã‚µãƒãƒ¼ãƒˆãƒ‘ãƒƒã‚¯</div>
            <div class="section-subtitle">å°å…¥å¾Œã®é‹ç”¨æ”¯æ´ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ»ç¨åˆ¥ï¼‰</div>
          </div>
        </div>
        <div class="support-toggle-wrap">
          <label class="support-toggle-label">
            <input type="checkbox" id="supportToggle">
            ã‚µãƒãƒ¼ãƒˆãƒ‘ãƒƒã‚¯ã‚’åˆ©ç”¨ã™ã‚‹
          </label>
        </div>
        <div class="support-pack-area" id="supportPackArea">
          <div class="support-pack-grid" id="supportPackGrid">
            <!-- Generated by JS -->
          </div>
          <div class="support-note">
            â€» æœ‰åŠ¹æœŸé™ï¼šæ³¨æ–‡æœˆã‹ã‚‰6ãƒ¶æœˆå¾Œã®æœˆæœ«ã¾ã§<br>
            â€» å…ˆæ‰•ã„åˆ¶ï¼ˆç™ºæ³¨æ™‚ã«ãŠæ”¯æ‰•ã„ï¼‰<br>
            â€» å·¥æ•°ã‚«ã‚¦ãƒ³ãƒˆã¯0.5æ™‚é–“å˜ä½
          </div>
          <div class="support-recommendation" id="supportRecommendation" style="display:none;"></div>
        </div>
      </div>

      <!-- â‘¤ Contract Period -->
      <div class="config-section">
        <div class="section-header">
          <div class="section-icon">ğŸ“…</div>
          <div>
            <div class="section-title">å¥‘ç´„æœŸé–“</div>
          </div>
        </div>
        <div class="period-segments" role="group" aria-label="å¥‘ç´„æœŸé–“">
          <button class="period-btn active" data-months="12">12ãƒ¶æœˆ</button>
          <button class="period-btn" data-months="24">24ãƒ¶æœˆ</button>
          <button class="period-btn" data-months="36">36ãƒ¶æœˆ</button>
        </div>
        <div class="contract-calc" id="contractCalc"></div>
      </div>
    </section>

    <!-- Right: Results -->
    <aside class="results-panel">
      <div class="results-card">
        <div class="results-header">
          <div class="results-title">è¦‹ç©æ¦‚ç®—</div>
          <div class="results-date" id="resultsDate"></div>
        </div>

        <!-- Monthly Cost -->
        <div class="result-category">æœˆé¡è²»ç”¨</div>
        <div class="total-section">
          <div class="total-label">æœˆé¡åˆè¨ˆï¼ˆç¨åˆ¥ï¼‰</div>
          <div class="total-amount" id="totalAmount">Â¥0</div>
          <div class="total-tax">ç¨è¾¼ï¼ˆ10%ï¼‰: <strong id="totalTax">Â¥0</strong></div>
          <div class="total-tax" style="margin-top:2px;">å¹´é–“è²»ç”¨ï¼ˆç¨è¾¼ï¼‰: <strong id="annualTotal">Â¥0</strong></div>
        </div>

        <!-- Initial Cost -->
        <div class="result-category">åˆæœŸè²»ç”¨ï¼ˆæ§‹ç¯‰è²»ç”¨ï¼‰</div>
        <div class="total-section">
          <div class="total-label">åˆæœŸè²»ç”¨åˆè¨ˆï¼ˆç¨è¾¼ï¼‰</div>
          <div class="total-amount" id="initialTotal" style="font-size:1.8rem;">Â¥0</div>
        </div>

        <!-- Grand Total -->
        <div class="result-category">ç·è²»ç”¨</div>
        <div class="grand-total-section">
          <div class="grand-total-label">åˆå¹´åº¦ç·è²»ç”¨ï¼ˆç¨è¾¼ï¼‰</div>
          <div class="grand-total-amount" id="grandTotal">Â¥0</div>
          <div class="grand-total-breakdown" id="grandTotalBreakdown"></div>
        </div>

        <!-- Chart -->
        <div class="chart-section">
          <div class="chart-container">
            <canvas id="costChart"></canvas>
          </div>
        </div>

        <!-- Detail Table -->
        <div class="detail-section">
          <div class="detail-section-title">è²»ç”¨æ˜ç´°</div>
          <table class="detail-table">
            <thead>
              <tr><th>é …ç›®</th><th>é‡‘é¡</th></tr>
            </thead>
            <tbody id="detailTableBody"></tbody>
          </table>
        </div>

        <!-- Notes -->
        <div class="notes-section">
          <div class="detail-section-title">æ³¨æ„äº‹é …</div>
          <div class="notes-category">ã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€‘</div>
          <ul class="notes-list">
            <li>æœ¬è¦‹ç©ã‚‚ã‚Šã¯æ¦‚ç®—ã§ã™ã€‚æ­£å¼ãªãŠè¦‹ç©ã‚‚ã‚Šã¯åˆ¥é€”ã”æç¤ºã„ãŸã—ã¾ã™ã€‚</li>
            <li>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æ–™é‡‘ãƒ»æ§‹ç¯‰è²»ç”¨ã¯ã™ã¹ã¦ç¨åˆ¥è¡¨ç¤ºã§ã™ã€‚åˆ¥é€”æ¶ˆè²»ç¨10%ãŒåŠ ç®—ã•ã‚Œã¾ã™ã€‚</li>
            <li>åŒæ™‚ãƒ­ã‚°ã‚¤ãƒ³ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯5ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å˜ä½ã§ã®è³¼å…¥ã¨ãªã‚Šã¾ã™ã€‚</li>
            <li>ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ã‹ã‚‰ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã¯å·®é¡ï¼ˆÂ¥50,000/æœˆï¼‰ã§ã®å¤‰æ›´ãŒå¯èƒ½ã§ã™ã€‚</li>
            <li>ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯2026å¹´2æœˆ17æ—¥æä¾›é–‹å§‹ã§ã™ã€‚</li>
            <li>å¥‘ç´„ã¯æœˆå˜ä½ã¾ãŸã¯å¹´å˜ä½ã€‚å¥‘ç´„æœŸé–“ä¸­ã®è§£ç´„ã¯æ®‹å­˜æœŸé–“åˆ†ã®æ”¯æ‰•ã„ç¾©å‹™ãŒç”Ÿã˜ã¾ã™ã€‚</li>
          </ul>
          <div class="notes-category">ã€ã‚µãƒãƒ¼ãƒˆãƒ‘ãƒƒã‚¯ã€‘</div>
          <ul class="notes-list">
            <li>ã‚µãƒãƒ¼ãƒˆãƒ‘ãƒƒã‚¯ã¯æœ‰åŠ¹æœŸé™ï¼ˆæ³¨æ–‡æœˆã‹ã‚‰6ãƒ¶æœˆå¾Œã®æœˆæœ«ï¼‰ãŒã‚ã‚Šã¾ã™ã€‚</li>
            <li>ã‚µãƒãƒ¼ãƒˆãƒ‘ãƒƒã‚¯ã¯å…ˆæ‰•ã„åˆ¶ã§ã™ï¼ˆç™ºæ³¨æ™‚ã«ãŠæ”¯æ‰•ã„ã„ãŸã ãã¾ã™ï¼‰ã€‚</li>
            <li>å·¥æ•°ã‚«ã‚¦ãƒ³ãƒˆã¯0.5æ™‚é–“å˜ä½ã§ã™ã€‚</li>
          </ul>
        </div>

        <!-- Actions -->
        <div class="action-bar">
          <button class="btn btn-primary" id="btnCopy"><span class="btn-icon">ğŸ“‹</span>ã‚³ãƒ”ãƒ¼</button>
          <button class="btn btn-secondary" id="btnPdf"><span class="btn-icon">ğŸ“„</span>PDFå‡ºåŠ›</button>
          <button class="btn btn-outline" id="btnReset">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
      </div>
    </aside>
  </main>

  <!-- Mobile Total Bar -->
  <div class="mobile-total-bar">
    <div class="mobile-total-inner">
      <div>
        <div class="mobile-total-label">åˆå¹´åº¦ç·è²»ç”¨ï¼ˆç¨è¾¼ï¼‰</div>
        <div class="mobile-total-amount" id="mobileTotalAmount">Â¥0</div>
      </div>
    </div>
  </div>

  <!-- Copy Feedback Toast -->
  <div class="copy-feedback" id="copyFeedback">ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ</div>

  <!-- ==========================================
       JavaScript
       ========================================== -->
  <script>
  (function() {
    'use strict';

    // ==========================================
    // PRICES - JUST.DB å…¬å¼æ–™é‡‘ï¼ˆç¨åˆ¥ï¼‰
    // ==========================================
    var PRICES = {
      license: { unitPrice: 15000, min: 5, max: 100, step: 5 },

      packages: {
        none:     { name: 'ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãªã—',         monthlyPrice: 0 },
        basic:    { name: 'ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸',     monthlyPrice: 24000 },
        standard: { name: 'ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸',   monthlyPrice: 74000, upgradeFromBasic: 50000 },
      },

      staffRates: {
        manager:          { name: 'ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼',         hourlyRate: 24000 },
        seniorConsultant: { name: 'ã‚·ãƒ‹ã‚¢ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆ', hourlyRate: 18000 },
        consultant:       { name: 'ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆ',       hourlyRate: 12000 },
        engineer:         { name: 'ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢',   hourlyRate: 8000 },
        associate:        { name: 'ã‚¢ã‚½ã‚·ã‚¨ã‚¤ãƒˆ',         hourlyRate: 8000 },
      },

      constructionPhases: {
        requirements: { name: 'è¦ä»¶æ•´ç†ãƒ»è¦ä»¶å®šç¾©',       role: 'seniorConsultant', defaultHours: 40, maxHours: 80,  description: 'As-Is/To-Beæ•´ç†ã€æ¥­å‹™ãƒ•ãƒ­ãƒ¼ä½œæˆ' },
        pm:           { name: 'PMãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†',     role: 'manager',          defaultHours: 20, maxHours: 40,  description: 'å®šä¾‹ä¼šãƒ»èª²é¡Œç®¡ç†ãƒ»è­°äº‹éŒ²ä½œæˆ' },
        development:  { name: 'æ§‹ç¯‰ãƒ»é–‹ç™ºï¼ˆã‚¢ã‚¸ãƒ£ã‚¤ãƒ«ï¼‰', role: 'consultant',       defaultHours: 60, maxHours: 120, description: 'ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ä½œæˆãƒ»å®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆãƒ»ä¿®æ­£' },
        training:     { name: 'æ•™è‚²ãƒ»ç ”ä¿®æ”¯æ´',           role: 'consultant',       defaultHours: 20, maxHours: 40,  description: 'DXæ‹…å½“è€…ç ”ä¿®ï¼ˆç´„9ã€œ10æ™‚é–“ï¼‰ï¼‹å€‹åˆ¥è£œåŠ©' },
        manual:       { name: 'ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãƒ»æˆæœç‰©ä½œæˆ',   role: 'associate',        defaultHours: 16, maxHours: 32,  description: 'DBå®šç¾©æ›¸ãƒ»æ¥­å‹™ãƒ—ãƒ¬ãƒ¼ãƒˆå®šç¾©æ›¸ä½œæˆ' },
      },

      supportPacks: {
        pack20: { name: 'ã‚µãƒãƒ¼ãƒˆãƒ‘ãƒƒã‚¯20', price: 400000,  hours: 20, unitPrice: 20000 },
        pack40: { name: 'ã‚µãƒãƒ¼ãƒˆãƒ‘ãƒƒã‚¯40', price: 700000,  hours: 40, unitPrice: 17500 },
        pack60: { name: 'ã‚µãƒãƒ¼ãƒˆãƒ‘ãƒƒã‚¯60', price: 1000000, hours: 60, unitPrice: 16666 },
      },

      taxRate: 0.10,
      animationDuration: 400,
    };

    // ==========================================
    // State
    // ==========================================
    var state = {
      licenseCount: 10,
      selectedPackage: 'none',
      contractMonths: 12,
      phaseHours: {
        requirements: 40, pm: 20, development: 60, training: 20, manual: 16,
      },
      useSupportPack: false,
      selectedSupportPack: null,
    };

    // Previous values for animation
    var prevMonthly = 0, prevMonthlyTax = 0, prevAnnual = 0;
    var prevInitial = 0, prevGrand = 0, prevMobile = 0;

    // ==========================================
    // Formatting
    // ==========================================
    var fmt = new Intl.NumberFormat('ja-JP');
    function yen(v) { return v == null ? '---' : 'Â¥' + fmt.format(v); }

    // ==========================================
    // Animation
    // ==========================================
    function animateVal(el, from, to, dur, prefix) {
      prefix = prefix || 'Â¥';
      var start = performance.now();
      function tick(now) {
        var p = Math.min((now - start) / dur, 1);
        var e = 1 - Math.pow(1 - p, 3);
        el.textContent = prefix + fmt.format(Math.round(from + (to - from) * e));
        if (p < 1) requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    }

    // ==========================================
    // Calculation
    // ==========================================
    function calculate() {
      var licenseCost = state.licenseCount * PRICES.license.unitPrice;
      var pkg = PRICES.packages[state.selectedPackage];
      var packageCost = pkg.monthlyPrice;

      var monthlySubtotal = licenseCost + packageCost;
      var monthlyTax = Math.floor(monthlySubtotal * PRICES.taxRate);
      var monthlyTotal = monthlySubtotal + monthlyTax;
      var annualTotal = monthlyTotal * 12;

      // Construction cost
      var constructionSubtotal = 0;
      var phaseDetails = [];
      var phaseKeys = Object.keys(PRICES.constructionPhases);
      for (var i = 0; i < phaseKeys.length; i++) {
        var key = phaseKeys[i];
        var phase = PRICES.constructionPhases[key];
        var staff = PRICES.staffRates[phase.role];
        var hours = state.phaseHours[key];
        var cost = hours * staff.hourlyRate;
        constructionSubtotal += cost;
        phaseDetails.push({ key: key, name: phase.name, role: staff.name, rate: staff.hourlyRate, hours: hours, cost: cost });
      }

      var supportPackCost = 0;
      var supportPackName = '';
      if (state.useSupportPack && state.selectedSupportPack) {
        var sp = PRICES.supportPacks[state.selectedSupportPack];
        supportPackCost = sp.price;
        supportPackName = sp.name;
      }

      var initialSubtotal = constructionSubtotal + supportPackCost;
      var initialTax = Math.floor(initialSubtotal * PRICES.taxRate);
      var initialTotal = initialSubtotal + initialTax;

      var grandTotal = annualTotal + initialTotal;

      var contractMonthlyTotal = monthlyTotal * state.contractMonths;
      var contractSubtotal = monthlySubtotal * state.contractMonths;

      // Total phase hours
      var totalPhaseHours = 0;
      for (var k in state.phaseHours) totalPhaseHours += state.phaseHours[k];

      return {
        licenseCost: licenseCost,
        packageCost: packageCost,
        packageName: pkg.name,
        monthlySubtotal: monthlySubtotal,
        monthlyTax: monthlyTax,
        monthlyTotal: monthlyTotal,
        annualTotal: annualTotal,
        constructionSubtotal: constructionSubtotal,
        phaseDetails: phaseDetails,
        supportPackCost: supportPackCost,
        supportPackName: supportPackName,
        initialSubtotal: initialSubtotal,
        initialTax: initialTax,
        initialTotal: initialTotal,
        grandTotal: grandTotal,
        contractMonths: state.contractMonths,
        contractMonthlyTotal: contractMonthlyTotal,
        contractSubtotal: contractSubtotal,
        totalPhaseHours: totalPhaseHours,
      };
    }

    // ==========================================
    // DOM
    // ==========================================
    var dom = {};
    function cacheDom() {
      var ids = ['licenseValue','licenseSlider','licenseMinus','licensePlus','licenseCostDisplay',
        'totalAmount','totalTax','annualTotal','initialTotal','grandTotal','grandTotalBreakdown',
        'detailTableBody','contractCalc','mobileTotalAmount','constructionTotal',
        'phaseList','supportToggle','supportPackArea','supportPackGrid','supportRecommendation',
        'btnCopy','btnPdf','btnReset','copyFeedback','headerDate','resultsDate','costChart'];
      for (var i = 0; i < ids.length; i++) dom[ids[i]] = document.getElementById(ids[i]);
    }

    // ==========================================
    // Chart
    // ==========================================
    var chart = null;
    function initChart() {
      chart = new Chart(dom.costChart.getContext('2d'), {
        type: 'doughnut',
        data: {
          labels: [], datasets: [{ data: [], backgroundColor: [], borderWidth: 0, borderRadius: 4 }]
        },
        options: {
          responsive: true, maintainAspectRatio: true, cutout: '65%',
          plugins: {
            legend: { position: 'bottom', labels: { font: { family: "'Noto Sans JP'", size: 11 }, padding: 14, usePointStyle: true, pointStyle: 'circle' } },
            tooltip: { callbacks: { label: function(ctx) { return ctx.label + ': Â¥' + fmt.format(ctx.parsed); } } }
          }
        }
      });
    }

    function updateChart(data) {
      var labels = [], values = [], colors = [];
      if (data.licenseCost > 0) { labels.push('ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ï¼ˆå¹´é–“ï¼‰'); values.push(data.licenseCost * 12); colors.push('#1a3a5c'); }
      if (data.packageCost > 0) { labels.push('ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆå¹´é–“ï¼‰'); values.push(data.packageCost * 12); colors.push('#2a5a8c'); }
      if (data.constructionSubtotal > 0) { labels.push('æ§‹ç¯‰è²»ç”¨'); values.push(data.constructionSubtotal); colors.push('#f07900'); }
      if (data.supportPackCost > 0) { labels.push('ã‚µãƒãƒ¼ãƒˆãƒ‘ãƒƒã‚¯'); values.push(data.supportPackCost); colors.push('#f5a623'); }
      chart.data.labels = labels;
      chart.data.datasets[0].data = values;
      chart.data.datasets[0].backgroundColor = colors;
      chart.update();
    }

    // ==========================================
    // Build Phase Sliders
    // ==========================================
    function buildPhaseList() {
      var html = '';
      var keys = Object.keys(PRICES.constructionPhases);
      for (var i = 0; i < keys.length; i++) {
        var key = keys[i];
        var p = PRICES.constructionPhases[key];
        var staff = PRICES.staffRates[p.role];
        var hours = state.phaseHours[key];
        var cost = hours * staff.hourlyRate;
        html += '<div class="phase-row" data-phase="' + key + '">' +
          '<div class="phase-row-header">' +
            '<span class="phase-name">' + p.name + '</span>' +
            '<span class="phase-subtotal" id="phaseCost_' + key + '">' + yen(cost) + '</span>' +
          '</div>' +
          '<div class="phase-meta">' + staff.name + ' Â¥' + fmt.format(staff.hourlyRate) + '/æ™‚ ï½œ ' + p.description + '</div>' +
          '<div class="phase-slider-row">' +
            '<input type="range" class="phase-slider" data-phase="' + key + '" min="0" max="' + p.maxHours + '" step="1" value="' + hours + '">' +
            '<span class="phase-hours" id="phaseHours_' + key + '">' + hours + 'h</span>' +
          '</div>' +
        '</div>';
      }
      dom.phaseList.innerHTML = html;
    }

    function buildSupportPacks() {
      var html = '';
      var keys = Object.keys(PRICES.supportPacks);
      for (var i = 0; i < keys.length; i++) {
        var key = keys[i];
        var sp = PRICES.supportPacks[key];
        html += '<div class="support-pack-card" data-pack="' + key + '">' +
          '<div class="support-pack-name">' + sp.name + '</div>' +
          '<div class="support-pack-price">' + yen(sp.price) + '</div>' +
          '<div class="support-pack-detail">' + sp.hours + 'æ™‚é–“</div>' +
          '<div class="support-pack-unit">å˜ä¾¡ Â¥' + fmt.format(sp.unitPrice) + '/æ™‚</div>' +
        '</div>';
      }
      dom.supportPackGrid.innerHTML = html;
    }

    // ==========================================
    // Render
    // ==========================================
    function render() {
      var data = calculate();

      // License
      dom.licenseValue.textContent = state.licenseCount;
      dom.licenseSlider.value = state.licenseCount;
      dom.licenseMinus.disabled = state.licenseCount <= PRICES.license.min;
      dom.licensePlus.disabled = state.licenseCount >= PRICES.license.max;
      dom.licenseCostDisplay.innerHTML = state.licenseCount + ' ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ Ã— Â¥15,000 = <strong>' + yen(data.licenseCost) + '</strong> /æœˆ';

      // Phase costs
      var phaseKeys = Object.keys(PRICES.constructionPhases);
      for (var i = 0; i < phaseKeys.length; i++) {
        var key = phaseKeys[i];
        var el = document.getElementById('phaseCost_' + key);
        var hEl = document.getElementById('phaseHours_' + key);
        if (el) el.textContent = yen(data.phaseDetails[i].cost);
        if (hEl) hEl.textContent = state.phaseHours[key] + 'h';
      }
      dom.constructionTotal.textContent = yen(data.constructionSubtotal);

      // Support recommendation
      if (state.useSupportPack && data.totalPhaseHours > 0) {
        var rec = recommendPacks(data.totalPhaseHours);
        dom.supportRecommendation.style.display = 'block';
        dom.supportRecommendation.textContent = 'ğŸ’¡ åˆè¨ˆå·¥æ•° ' + data.totalPhaseHours + 'æ™‚é–“ â†’ ' + rec;
      } else {
        dom.supportRecommendation.style.display = 'none';
      }

      // Totals with animation
      var dur = PRICES.animationDuration;
      animateVal(dom.totalAmount, prevMonthly, data.monthlySubtotal, dur);
      prevMonthly = data.monthlySubtotal;
      animateVal(dom.totalTax, prevMonthlyTax, data.monthlyTotal, dur);
      prevMonthlyTax = data.monthlyTotal;
      animateVal(dom.annualTotal, prevAnnual, data.annualTotal, dur);
      prevAnnual = data.annualTotal;
      animateVal(dom.initialTotal, prevInitial, data.initialTotal, dur);
      prevInitial = data.initialTotal;
      animateVal(dom.grandTotal, prevGrand, data.grandTotal, dur);
      prevGrand = data.grandTotal;
      animateVal(dom.mobileTotalAmount, prevMobile, data.grandTotal, dur);
      prevMobile = data.grandTotal;

      dom.grandTotalBreakdown.textContent = 'æœˆé¡' + yen(data.monthlyTotal) + ' Ã— 12ãƒ¶æœˆ ï¼‹ åˆæœŸè²»ç”¨' + yen(data.initialTotal);

      // Contract calc
      dom.contractCalc.innerHTML = yen(data.monthlySubtotal) + ' Ã— ' + data.contractMonths + 'ãƒ¶æœˆ = <strong>' + yen(data.contractSubtotal) + '</strong>ï¼ˆç¨åˆ¥ï¼‰';

      // Detail table
      var rows = '';
      rows += '<tr class="section-label"><td colspan="2">â– æœˆé¡è²»ç”¨</td></tr>';
      rows += '<tr><td>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ï¼ˆ' + state.licenseCount + 'å Ã— Â¥15,000ï¼‰</td><td>' + yen(data.licenseCost) + '/æœˆ</td></tr>';
      if (state.selectedPackage !== 'none') {
        rows += '<tr><td>' + data.packageName + '</td><td>' + yen(data.packageCost) + '/æœˆ</td></tr>';
      }
      rows += '<tr class="subtotal-row"><td>æœˆé¡åˆè¨ˆï¼ˆç¨åˆ¥ï¼‰</td><td>' + yen(data.monthlySubtotal) + '</td></tr>';
      rows += '<tr><td>æ¶ˆè²»ç¨ï¼ˆ10%ï¼‰</td><td>' + yen(data.monthlyTax) + '</td></tr>';
      rows += '<tr class="subtotal-row"><td>æœˆé¡åˆè¨ˆï¼ˆç¨è¾¼ï¼‰</td><td>' + yen(data.monthlyTotal) + '</td></tr>';
      rows += '<tr><td>å¹´é–“è²»ç”¨ï¼ˆç¨è¾¼ï¼‰</td><td>' + yen(data.annualTotal) + '</td></tr>';

      rows += '<tr class="section-label"><td colspan="2">â– åˆæœŸè²»ç”¨ï¼ˆæ§‹ç¯‰ï¼‰</td></tr>';
      for (var j = 0; j < data.phaseDetails.length; j++) {
        var pd = data.phaseDetails[j];
        if (pd.hours > 0) {
          rows += '<tr><td>' + pd.name + 'ï¼ˆ' + pd.hours + 'h Ã— Â¥' + fmt.format(pd.rate) + 'ï¼‰</td><td>' + yen(pd.cost) + '</td></tr>';
        }
      }
      if (data.supportPackCost > 0) {
        rows += '<tr><td>' + data.supportPackName + '</td><td>' + yen(data.supportPackCost) + '</td></tr>';
      }
      rows += '<tr class="subtotal-row"><td>åˆæœŸè²»ç”¨åˆè¨ˆï¼ˆç¨åˆ¥ï¼‰</td><td>' + yen(data.initialSubtotal) + '</td></tr>';
      rows += '<tr><td>æ¶ˆè²»ç¨ï¼ˆ10%ï¼‰</td><td>' + yen(data.initialTax) + '</td></tr>';
      rows += '<tr class="subtotal-row"><td>åˆæœŸè²»ç”¨åˆè¨ˆï¼ˆç¨è¾¼ï¼‰</td><td>' + yen(data.initialTotal) + '</td></tr>';

      rows += '<tr class="section-label"><td colspan="2">â– å¥‘ç´„æœŸé–“è²»ç”¨</td></tr>';
      rows += '<tr><td>æœˆé¡ Ã— ' + data.contractMonths + 'ãƒ¶æœˆï¼ˆç¨è¾¼ï¼‰</td><td>' + yen(data.contractMonthlyTotal) + '</td></tr>';

      dom.detailTableBody.innerHTML = rows;

      // Chart
      updateChart(data);
    }

    // ==========================================
    // Support Pack Recommendation
    // ==========================================
    function recommendPacks(totalHours) {
      var best = null, bestCost = Infinity;
      var packs = [
        { name: 'ãƒ‘ãƒƒã‚¯60', hours: 60, price: 1000000 },
        { name: 'ãƒ‘ãƒƒã‚¯40', hours: 40, price: 700000 },
        { name: 'ãƒ‘ãƒƒã‚¯20', hours: 20, price: 400000 },
      ];
      // Simple greedy
      for (var a = 0; a <= 3; a++) {
        for (var b = 0; b <= 4; b++) {
          for (var c = 0; c <= 8; c++) {
            var h = a * 60 + b * 40 + c * 20;
            var cost = a * 1000000 + b * 700000 + c * 400000;
            if (h >= totalHours && cost < bestCost) {
              bestCost = cost;
              best = [];
              if (a > 0) best.push('ãƒ‘ãƒƒã‚¯60 Ã— ' + a);
              if (b > 0) best.push('ãƒ‘ãƒƒã‚¯40 Ã— ' + b);
              if (c > 0) best.push('ãƒ‘ãƒƒã‚¯20 Ã— ' + c);
            }
          }
        }
      }
      return best && best.length > 0 ? best.join(' ï¼‹ ') + 'ï¼ˆ' + yen(bestCost) + 'ï¼‰ãŒãŠã™ã™ã‚' : 'å€‹åˆ¥ã«ã”ç›¸è«‡ãã ã•ã„';
    }

    // ==========================================
    // Events
    // ==========================================
    function setLicense(v) {
      v = Math.max(PRICES.license.min, Math.min(PRICES.license.max, v));
      v = Math.round(v / PRICES.license.step) * PRICES.license.step;
      state.licenseCount = v;
      render();
    }

    function attachEvents() {
      dom.licenseMinus.addEventListener('click', function() { setLicense(state.licenseCount - PRICES.license.step); });
      dom.licensePlus.addEventListener('click', function() { setLicense(state.licenseCount + PRICES.license.step); });
      dom.licenseSlider.addEventListener('input', function() { setLicense(parseInt(this.value, 10)); });

      dom.licenseValue.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') { e.preventDefault(); var v = parseInt(this.textContent.replace(/\D/g,''),10); if (!isNaN(v)) setLicense(v); this.blur(); }
        else if (e.key === 'Escape') { this.textContent = state.licenseCount; this.blur(); }
      });
      dom.licenseValue.addEventListener('blur', function() {
        var v = parseInt(this.textContent.replace(/\D/g,''),10);
        if (!isNaN(v)) setLicense(v); else this.textContent = state.licenseCount;
      });

      // Long press
      var lpTimer, lpInterval;
      function startLp(dir) { lpTimer = setTimeout(function() { lpInterval = setInterval(function() { setLicense(state.licenseCount + dir * PRICES.license.step); }, 120); }, 400); }
      function stopLp() { clearTimeout(lpTimer); clearInterval(lpInterval); }
      dom.licenseMinus.addEventListener('mousedown', function() { startLp(-1); });
      dom.licenseMinus.addEventListener('mouseup', stopLp);
      dom.licenseMinus.addEventListener('mouseleave', stopLp);
      dom.licensePlus.addEventListener('mousedown', function() { startLp(1); });
      dom.licensePlus.addEventListener('mouseup', stopLp);
      dom.licensePlus.addEventListener('mouseleave', stopLp);

      // Package cards
      document.querySelectorAll('.package-card').forEach(function(card) {
        card.addEventListener('click', function() {
          document.querySelectorAll('.package-card').forEach(function(c) { c.classList.remove('selected'); });
          this.classList.add('selected');
          state.selectedPackage = this.dataset.package;
          render();
        });
      });

      // Phase sliders (delegation)
      dom.phaseList.addEventListener('input', function(e) {
        if (e.target.classList.contains('phase-slider')) {
          var phase = e.target.dataset.phase;
          state.phaseHours[phase] = parseInt(e.target.value, 10);
          render();
        }
      });

      // Support toggle
      dom.supportToggle.addEventListener('change', function() {
        state.useSupportPack = this.checked;
        dom.supportPackArea.classList.toggle('visible', this.checked);
        if (!this.checked) { state.selectedSupportPack = null; deselectAllPacks(); }
        render();
      });

      // Support pack cards (delegation)
      dom.supportPackGrid.addEventListener('click', function(e) {
        var card = e.target.closest('.support-pack-card');
        if (!card) return;
        document.querySelectorAll('.support-pack-card').forEach(function(c) { c.classList.remove('selected'); });
        card.classList.add('selected');
        state.selectedSupportPack = card.dataset.pack;
        render();
      });

      // Contract period
      document.querySelectorAll('.period-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.period-btn').forEach(function(b) { b.classList.remove('active'); });
          this.classList.add('active');
          state.contractMonths = parseInt(this.dataset.months, 10);
          render();
        });
      });

      // Copy
      dom.btnCopy.addEventListener('click', function() {
        navigator.clipboard.writeText(generateSummary()).then(function() {
          dom.copyFeedback.classList.add('show');
          setTimeout(function() { dom.copyFeedback.classList.remove('show'); }, 2000);
        });
      });

      // PDF
      dom.btnPdf.addEventListener('click', function() { window.print(); });

      // Reset
      dom.btnReset.addEventListener('click', resetAll);
    }

    function deselectAllPacks() {
      document.querySelectorAll('.support-pack-card').forEach(function(c) { c.classList.remove('selected'); });
    }

    function resetAll() {
      state.licenseCount = 10;
      state.selectedPackage = 'none';
      state.contractMonths = 12;
      state.phaseHours = { requirements: 40, pm: 20, development: 60, training: 20, manual: 16 };
      state.useSupportPack = false;
      state.selectedSupportPack = null;

      document.querySelectorAll('.package-card').forEach(function(c) { c.classList.remove('selected'); });
      document.querySelector('[data-package="none"]').classList.add('selected');
      document.querySelectorAll('.period-btn').forEach(function(b) { b.classList.remove('active'); });
      document.querySelector('[data-months="12"]').classList.add('active');
      dom.supportToggle.checked = false;
      dom.supportPackArea.classList.remove('visible');
      deselectAllPacks();

      prevMonthly = prevMonthlyTax = prevAnnual = prevInitial = prevGrand = prevMobile = 0;

      buildPhaseList();
      render();
    }

    // ==========================================
    // Summary (clipboard)
    // ==========================================
    function generateSummary() {
      var data = calculate();
      var d = new Date();
      var ds = d.getFullYear() + '/' + (d.getMonth()+1) + '/' + d.getDate();
      var L = [];
      L.push('========================================');
      L.push('JUST.DB è¦‹ç©æ¦‚ç®—');
      L.push('ä½œæˆæ—¥: ' + ds);
      L.push('========================================');
      L.push('');
      L.push('â–  ãƒ©ã‚¤ã‚»ãƒ³ã‚¹');
      L.push('  åŒæ™‚ãƒ­ã‚°ã‚¤ãƒ³ãƒ©ã‚¤ã‚»ãƒ³ã‚¹: ' + state.licenseCount + ' ãƒ©ã‚¤ã‚»ãƒ³ã‚¹');
      L.push('  æœˆé¡: ' + yen(data.licenseCost) + 'ï¼ˆç¨åˆ¥ï¼‰');
      L.push('');
      L.push('â–  ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸');
      L.push('  ' + data.packageName + ': ' + yen(data.packageCost) + '/æœˆï¼ˆç¨åˆ¥ï¼‰');
      L.push('');
      L.push('â–  æœˆé¡è²»ç”¨');
      L.push('  æœˆé¡åˆè¨ˆï¼ˆç¨åˆ¥ï¼‰: ' + yen(data.monthlySubtotal));
      L.push('  æ¶ˆè²»ç¨ï¼ˆ10%ï¼‰: ' + yen(data.monthlyTax));
      L.push('  æœˆé¡åˆè¨ˆï¼ˆç¨è¾¼ï¼‰: ' + yen(data.monthlyTotal));
      L.push('  å¹´é–“è²»ç”¨ï¼ˆç¨è¾¼ï¼‰: ' + yen(data.annualTotal));
      L.push('');
      L.push('â–  æ§‹ç¯‰è²»ç”¨ï¼ˆåˆæœŸè²»ç”¨ï¼‰');
      for (var i = 0; i < data.phaseDetails.length; i++) {
        var pd = data.phaseDetails[i];
        if (pd.hours > 0) L.push('  ' + pd.name + ': ' + pd.hours + 'h Ã— Â¥' + fmt.format(pd.rate) + ' = ' + yen(pd.cost));
      }
      if (data.supportPackCost > 0) L.push('  ' + data.supportPackName + ': ' + yen(data.supportPackCost));
      L.push('  åˆæœŸè²»ç”¨åˆè¨ˆï¼ˆç¨åˆ¥ï¼‰: ' + yen(data.initialSubtotal));
      L.push('  åˆæœŸè²»ç”¨åˆè¨ˆï¼ˆç¨è¾¼ï¼‰: ' + yen(data.initialTotal));
      L.push('');
      L.push('â–  å¥‘ç´„æœŸé–“: ' + data.contractMonths + 'ãƒ¶æœˆ');
      L.push('  æœˆé¡ Ã— ' + data.contractMonths + 'ãƒ¶æœˆï¼ˆç¨è¾¼ï¼‰: ' + yen(data.contractMonthlyTotal));
      L.push('');
      L.push('â–  åˆå¹´åº¦ç·è²»ç”¨ï¼ˆç¨è¾¼ï¼‰: ' + yen(data.grandTotal));
      L.push('  ï¼ˆæœˆé¡ Ã— 12ãƒ¶æœˆ + åˆæœŸè²»ç”¨ï¼‰');
      L.push('');
      L.push('========================================');
      L.push('â€» æœ¬è¦‹ç©ã‚‚ã‚Šã¯æ¦‚ç®—ã§ã™ã€‚æ­£å¼ãªãŠè¦‹ç©ã‚‚ã‚Šã¯åˆ¥é€”ã”æç¤ºã„ãŸã—ã¾ã™ã€‚');
      L.push('========================================');
      return L.join('\n');
    }

    // ==========================================
    // Date
    // ==========================================
    function setDate() {
      var d = new Date();
      var s = d.getFullYear() + 'å¹´' + (d.getMonth()+1) + 'æœˆ' + d.getDate() + 'æ—¥';
      dom.headerDate.textContent = s;
      dom.resultsDate.textContent = 'ä½œæˆæ—¥: ' + s;
    }

    // ==========================================
    // Init
    // ==========================================
    function init() {
      cacheDom();
      setDate();
      buildPhaseList();
      buildSupportPacks();
      initChart();
      attachEvents();
      render();
    }

    document.addEventListener('DOMContentLoaded', init);
  })();
  </script>
</body>
</html>
